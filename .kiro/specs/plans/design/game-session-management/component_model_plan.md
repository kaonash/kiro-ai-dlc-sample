# ゲームセッション管理ユニット コンポーネントモデル設計計画

## 概要
ゲームセッション管理ユニットのユーザーストーリーを実装するためのコンポーネントモデルを設計する計画です。このユニットは、ゲームライフサイクル、3分タイマー、スコア管理、ゲーム終了判定を担当します。

## 前提条件
- ユニット定義書（unit.md）が完成済み
- 2つのユーザーストーリーが明確に定義済み
- AI-DLC手法とDDD原則に従った設計
- TypeScript + Bun技術スタックを採用

## 対象ユーザーストーリー
1. **ストーリー1.1**: クイックゲームセッション開始（優先度：高）
2. **ストーリー1.2**: ゲーム終了とスコア表示（優先度：高）

## 作業ステップ

### フェーズ1: 分析・準備
- [x] **ステップ1**: ユーザーストーリーと受入基準の詳細分析
  - 各ストーリーの核となる機能を特定
  - ドメインエンティティとビジネスルールを抽出
  - 外部依存関係（他ユニットとの連携）を明確化

- [x] **ステップ2**: ドメイン知識の整理
  - **要確認**: ゲームセッションの状態遷移（開始→進行中→終了）
  - **要確認**: スコア計算の詳細ロジック（倒した敵数、生存時間、使用カード数の重み付け）
  - **要確認**: タイマーの精度要件（秒単位？ミリ秒単位？）
  - **要確認**: ゲーム終了条件（時間切れ、体力ゼロ、その他）

### フェーズ2: ドメインモデル設計
- [x] **ステップ3**: コアドメインエンティティの特定
  - GameSession、GameTimer、GameScore、GameStateなどの主要エンティティを定義
  - 各エンティティの責任と境界を明確化
  - 値オブジェクトと集約の識別

- [x] **ステップ4**: ビジネスルールとドメインサービスの定義
  - ゲーム状態管理ルール
  - スコア計算アルゴリズム
  - タイマー制御ロジック
  - ゲーム終了判定ルール

### フェーズ3: コンポーネント相互作用設計
- [x] **ステップ5**: ユースケース実現のためのコンポーネント相互作用を設計
  - ゲーム開始フロー
  - タイマー更新とUI通知フロー
  - ゲーム終了とスコア計算フロー
  - 結果表示と新ゲーム開始フロー

- [x] **ステップ6**: 外部システムとのインターフェース設計
  - **要確認**: 他ユニット（カード管理、敵システム、タワー戦闘、UI）との連携方式
  - **要確認**: イベント駆動型 vs 直接呼び出し型の選択
  - **要確認**: ゲーム状態の共有方法（グローバル状態 vs イベント通知）

### フェーズ4: 技術的考慮事項
- [x] **ステップ7**: パフォーマンスと信頼性の考慮
  - タイマーの精度とパフォーマンス（setInterval vs requestAnimationFrame）
  - ゲーム状態の一貫性保証
  - メモリリークの防止（タイマーのクリーンアップ）

- [x] **ステップ8**: テスタビリティとメンテナンス性の考慮
  - 時間依存処理のテスト方法
  - モックタイマーの活用方針
  - ゲーム状態のスナップショット機能

### フェーズ5: 文書化・検証
- [x] **ステップ9**: コンポーネントモデル文書の作成
  - .kiro/specs/design-artifacts/game-session-management/component_model.md として保存
  - 日本語での記述、構造化された形式で作成
  - 状態遷移図やシーケンス図の検討

- [x] **ステップ10**: 設計の整合性検証
  - 全ユーザーストーリーがコンポーネントモデルで実現可能であることを確認
  - 外部依存関係が適切に定義されていることを確認
  - DDD原則（高凝集・疎結合）が守られていることを確認

## 確認済み事項

### 1. ゲームセッション仕様の詳細
- **確認済み**: ゲームセッションの正確な時間は3分（180秒）固定
- **確認済み**: タイマーの表示形式は残り秒数＆プログレスバー
- **確認済み**: ゲーム一時停止機能は必要
- **確認済み**: ゲーム途中での離脱時の処理は内容をリセット、次回は最初から

### 2. スコア計算の詳細
- **確認済み**: スコアの構成要素は倒した敵数×10（通常敵）、強化敵×30、ボス敵×100
- **確認済み**: 最高スコアの記録・表示は不要
- **確認済み**: スコアランキング機能は不要
- **確認済み**: スコアの永続化は不要

### 3. ゲーム状態管理
- **確認済み**: プレイヤーの体力（ライフ）の初期値は100
- **確認済み**: ゲーム終了条件の優先順位は時間切れを優先
- **確認済み**: ゲーム中の統計情報（倒した敵数、使用カード数）の管理は最初は不要

### 4. 他ユニットとの連携
- **確認済み**: イベント駆動型連携を採用
- **確認済み**: 敵撃破、カード使用、ダメージ受領はイベント受信
- **確認済み**: ゲーム状態変更は他ユニットにイベント発行
- **確認済み**: ゲーム終了時はGameEndedEventを発行してクリーンアップ

### 5. UI・UX要件
- **確認済み**: ゲーム開始時のローディング画面は不要
- **確認済み**: ゲーム終了時のアニメーション演出は不要
- **確認済み**: 結果画面での詳細統計表示は不要

## 成果物
- コンポーネントモデル文書（.kiro/specs/design-artifacts/game-session-management/component_model.md）
- 必要に応じて状態遷移図やシーケンス図
- 外部インターフェース仕様

## 次のステップ
この計画の承認後、ステップ1から順次実行し、各ステップ完了時にチェックボックスを更新します。すべての確認事項が解決された後にコンポーネントモデルの作成を開始します。