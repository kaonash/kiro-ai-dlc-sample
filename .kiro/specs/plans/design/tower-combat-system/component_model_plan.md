# タワー・戦闘システム コンポーネントモデル設計計画

## 計画概要

tower-combat-systemユニットのコンポーネントモデルを設計し、ユーザーストーリー3.1（多様なタワー特性）と3.2（自動戦闘システム）を実現するための包括的な設計を行います。

## 設計ステップ

### ステップ1: 既存システムとの整合性確認
- [x] 既存のカード・戦略管理システムとのインターフェース定義確認
- [x] 敵・チャレンジシステムとの連携ポイント確認
- [x] 既存のTowerType、SpecialAbility値オブジェクトとの整合性確認
- [x] 既存のEnemyDamageService、BaseAttackServiceとの統合方針確認

**確認済み事項**: 
- カードからタワーへの変換仕様：カード属性を直接マッピング、攻撃頻度属性を追加
- タワーの配置位置制約：戦場サイズ1200x800px、重複配置禁止、配置エリア制限なし
- 敵との相互作用：既存のPosition値オブジェクトを使用

### ステップ2: ドメインエンティティ設計
- [x] Towerエンティティの設計（集約ルート）
- [x] TowerStatsエンティティの設計
- [x] CombatSessionエンティティの設計（戦闘状態管理）
- [x] 各エンティティの属性、メソッド、責任の定義

**設計完了**:
- タワーの状態管理：アクティブ/非アクティブ、攻撃クールダウン、特殊能力クールダウン
- アップグレード機能：将来拡張として考慮、現在は実装しない

### ステップ3: 値オブジェクト設計
- [x] TowerStats値オブジェクトの設計
- [x] AttackRange値オブジェクトの設計
- [x] CombatResult値オブジェクトの設計
- [x] TargetingPriority値オブジェクトの設計

### ステップ4: ドメインサービス設計
- [x] TowerPlacementService（タワー配置サービス）
- [x] TowerCombatService（タワー戦闘サービス）
- [x] TargetingService（ターゲティングサービス）
- [x] SpecialAbilityService（特殊能力サービス）
- [x] ScoreCalculationService（スコア計算サービス）
- [x] 既存のEnemyDamageService、BaseAttackServiceとの統合

**設計完了**:
- ターゲティングアルゴリズム：距離ベースの「最も近い敵優先」を実装
- 特殊能力：クールダウン制御、範囲効果、ステータス効果を設計

### ステップ5: 外部インターフェース設計
- [x] カード・戦略管理システムとの連携インターフェース
- [x] 敵・チャレンジシステムとの連携インターフェース
- [x] UI・フィードバックシステムとの連携インターフェース
- [x] ゲームセッション管理システムとの連携インターフェース

### ステップ6: ユースケース実現フロー設計
- [x] タワー配置フロー（カードプレイからタワー配置まで）
- [x] 自動戦闘フロー（敵検出、ターゲティング、攻撃実行）
- [x] 特殊能力発動フロー
- [x] スコア加算・エフェクト表示フロー

### ステップ7: データ構造と設定管理
- [x] タワー設定データ構造の設計
- [x] 戦闘バランス設定の設計
- [x] パフォーマンス最適化の考慮事項

**設計完了**:
- バランス調整：JSON設定による動的調整、コスト効率重視
- パフォーマンス：60FPS更新、最大20タワー、50同時攻撃対応

### ステップ8: エラーハンドリングとテスト戦略
- [x] エラーハンドリング戦略の設計
- [x] 単体テスト・統合テストの対象と戦略
- [x] モック・スタブ戦略の設計

### ステップ9: 将来拡張性の考慮
- [x] 新タワータイプ追加への対応
- [x] マルチプレイヤー対応の考慮
- [x] AI強化の可能性

### ステップ10: 最終レビューと文書化
- [x] コンポーネントモデル文書の作成
- [x] 設計決定の根拠と制約事項の記録
- [x] 他ユニットとの整合性最終確認

## 重要な設計決定事項

以下の事項について、実装前に明確化が必要です：

1. **タワー配置の制約**
   - 戦場のサイズと座標系
   - 配置可能エリアの定義
   - タワー間の最小距離制約

2. **戦闘システムの詳細**
   - 攻撃頻度の制御方法
   - 複数タワーの同時攻撃処理
   - 特殊能力の発動条件と効果

3. **パフォーマンス要件**
   - 同時処理可能なタワー数の上限
   - リアルタイム処理の更新頻度
   - メモリ使用量の制約

4. **バランス調整**
   - タワータイプ間のバランス
   - コスト効率の設計指針
   - 難易度カーブとの整合性

## 承認待ち

この計画に基づいてコンポーネントモデルの設計を進めてよろしいでしょうか？
特に確認事項として挙げた点について、ご指示をお願いします。