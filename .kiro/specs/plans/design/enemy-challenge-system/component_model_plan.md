# 敵・チャレンジシステム コンポーネントモデル設計計画

## 計画概要

**対象ユニット**: 敵・チャレンジシステム  
**責任範囲**: 敵生成、移動、基地攻撃ロジック  
**技術的境界**: 敵AI、パスファインディング、波生成  
**外部依存**: ゲームセッション管理（ユニット1）

## 設計ステップ

### フェーズ1: 要件分析と確認事項の整理

- [x] **ステップ1.1**: ユーザーストーリー4.1の詳細分析
  - 敵の波による挑戦の具体的な要件を整理
  - 受入基準の技術的実装要件への変換

- [x] **ステップ1.2**: 確認事項の整理と質問
  - **確認完了**: 敵の種類とバリエーション（基本、遠距離攻撃、高速、強化、ボス敵の5種類）
  - **確認完了**: 敵の移動パスの定義方法（固定曲線パス、複数登場地点、分岐なし）
  - **確認完了**: 波の生成間隔とスケーリング方式（30秒間隔、波ごとに10匹増加）
  - **確認完了**: プレイヤー基地の体力システム（初期値1000、平均ダメージ50）
  - **確認完了**: 敵の基本ステータス範囲（タワー2回攻撃で撃破、10秒で基地到達）
  - **確認完了**: 難易度カーブの具体的な仕様（個体強化なし、数のみ増加）

### フェーズ2: ドメインモデル設計

- [x] **ステップ2.1**: 敵関連エンティティの設計
  - Enemy（敵）エンティティの属性と責任定義
  - EnemyType（敵タイプ）値オブジェクトの設計
  - EnemyStats（敵ステータス）値オブジェクトの設計

- [x] **ステップ2.2**: 波管理エンティティの設計
  - EnemyWave（敵の波）エンティティの設計
  - WaveConfiguration（波設定）値オブジェクトの設計
  - WaveScheduler（波スケジューラー）エンティティの設計

- [x] **ステップ2.3**: パス・移動関連の設計
  - MovementPath（移動パス）値オブジェクトの設計
  - Position（位置）値オブジェクトの設計
  - MovementBehavior（移動挙動）の設計

### フェーズ3: ドメインサービス設計

- [x] **ステップ3.1**: 敵生成サービスの設計
  - EnemySpawningService（敵生成サービス）の責任と方法定義
  - 波の生成ロジックとタイミング制御

- [x] **ステップ3.2**: 移動・AI制御サービスの設計
  - EnemyMovementService（敵移動サービス）の設計
  - PathfindingService（パスファインディングサービス）の設計

- [x] **ステップ3.3**: 基地攻撃・ダメージ処理サービスの設計
  - BaseAttackService（基地攻撃サービス）の設計
  - EnemyDamageService（敵ダメージサービス）の設計

### フェーズ4: 外部インターフェース設計

- [x] **ステップ4.1**: ゲームセッション管理との連携インターフェース
  - プレイヤー体力更新インターフェース
  - ゲーム時間・状態取得インターフェース

- [x] **ステップ4.2**: タワー・戦闘システムとの連携インターフェース
  - 敵へのダメージ受信インターフェース
  - 敵の状態情報提供インターフェース

- [x] **ステップ4.3**: UI・フィードバックシステムとの連携インターフェース
  - 敵の視覚表示インターフェース
  - 体力バー・状態表示インターフェース

### フェーズ5: 統合設計とフロー定義

- [x] **ステップ5.1**: ユースケース実現フローの設計
  - 敵の波生成フロー
  - 敵の移動・AI制御フロー
  - 基地攻撃・ダメージ処理フロー

- [x] **ステップ5.2**: データ構造と設定管理の設計
  - 敵設定データ（enemies.json）の構造設計
  - 波設定データ（waves.json）の構造設計
  - パス設定データ（paths.json）の構造設計

- [x] **ステップ5.3**: エラーハンドリングとテスト戦略の設計
  - 異常系処理の設計
  - 単体テスト・統合テストの戦略定義

### フェーズ6: 文書化と最終確認

- [x] **ステップ6.1**: コンポーネントモデル文書の作成
  - 全体アーキテクチャ図の作成
  - 各コンポーネントの詳細仕様記述

- [x] **ステップ6.2**: 設計レビューと承認要求
  - 設計内容の最終確認
  - ユーザーからの承認取得

- [x] **ステップ6.3**: 完了マーカーの作成
  - completed.txtファイルの作成

## 重要な確認事項

以下の項目について、設計を進める前に明確化が必要です：

### 1. 敵の種類とバリエーション
- 基本敵、強化敵、ボス敵などの分類
- 各敵タイプの特徴と能力
- 敵の見た目・アニメーション要件

### 2. 移動パスの仕様
- 固定パス vs 動的パス生成
- パスの複雑さ（直線、曲線、分岐）
- パス上での敵の挙動（追い越し、渋滞処理）

### 3. 波生成の詳細仕様
- 波の生成間隔（秒単位）
- 1波あたりの敵数
- 難易度スケーリングの方式

### 4. プレイヤー基地システム
- 基地の初期体力
- 敵1体あたりのダメージ量
- ゲームオーバー条件

### 5. 敵のステータス仕様
- 体力の範囲（最小〜最大）
- 移動速度の範囲
- 攻撃力（基地攻撃時）の範囲

### 6. 難易度カーブ
- 時間経過による敵強化の方式
- 波数による難易度上昇
- プレイヤーの進行に応じた調整

## 次のアクション

1. 上記の確認事項について回答をお願いします
2. 回答後、フェーズ1から順次実行します
3. 各ステップ完了時にチェックボックスを更新します
4. 最終的にコンポーネントモデル文書を作成します

---

**作成日**: 2025年1月1日  
**作成者**: AI Assistant  
**対象ユニット**: 敵・チャレンジシステム