# カード・戦略管理ユニット コンポーネントモデル設計計画

## 概要
カード・戦略管理ユニットのユーザーストーリーを実装するためのコンポーネントモデルを設計する計画です。このユニットは、カード配布、手札管理、カードプレイロジックを担当します。

## 前提条件
- ユニット定義書（unit.md）が完成済み
- 3つのユーザーストーリーが明確に定義済み
- AI-DLC手法とDDD原則に従った設計
- TypeScript + Bun技術スタックを採用

## 対象ユーザーストーリー
1. **ストーリー2.1**: ランダムカード配布（優先度：高）
2. **ストーリー2.2**: 戦略的カードプレイ（優先度：高）
3. **ストーリー2.3**: 多様なカードタイプの発見（優先度：中）

## 作業ステップ

### フェーズ1: 分析・準備
- [x] **ステップ1**: ユーザーストーリーと受入基準の詳細分析
  - 各ストーリーの核となる機能を特定
  - ドメインエンティティとビジネスルールを抽出
  - 外部依存関係（タワー配置システム、UIシステム）を明確化

- [x] **ステップ2**: ドメイン知識の整理
  - **確認完了**: カードの基本属性（コスト1-20、タワータイプ3種、特殊能力15種以上）
  - **確認完了**: カードプールの管理方法（JSON設定ファイル、将来的にDB）
  - **確認完了**: 手札の最大枚数制限（8枚固定）や並び順（コスト順）

### フェーズ2: ドメインモデル設計
- [x] **ステップ3**: コアドメインエンティティの特定
  - Card、Hand、CardPool、CardLibraryなどの主要エンティティを定義
  - 各エンティティの責任と境界を明確化
  - 値オブジェクトと集約の識別

- [x] **ステップ4**: ビジネスルールとドメインサービスの定義
  - カード選択アルゴリズム（重複排除、ランダム性）
  - カードプレイ検証ロジック
  - カードライブラリ管理ルール

### フェーズ3: コンポーネント相互作用設計
- [x] **ステップ5**: ユースケース実現のためのコンポーネント相互作用を設計
  - ゲーム開始時のカード配布フロー
  - カードドラッグ&ドロップ処理フロー
  - カードライブラリ更新フロー

- [x] **ステップ6**: 外部システムとのインターフェース設計
  - **確認完了**: タワー配置システムとの連携（直接呼び出し、エラー時復元）
  - UIシステムとの連携インターフェース
  - ゲームセッション管理システムとの連携

### フェーズ4: 技術的考慮事項
- [x] **ステップ7**: パフォーマンスと拡張性の考慮
  - カードデータの効率的な管理方法
  - ランダム生成アルゴリズムの品質保証
  - メモリ使用量の最適化

- [x] **ステップ8**: テスタビリティとメンテナンス性の考慮
  - 単体テスト可能な設計
  - モックやスタブの活用方針
  - 設定変更への対応

### フェーズ5: 文書化・検証
- [x] **ステップ9**: コンポーネントモデル文書の作成
  - .kiro/specs/design-artifacts/card-strategy-management/component_model.md として保存
  - 日本語での記述、構造化された形式で作成
  - UMLクラス図やシーケンス図の検討

- [x] **ステップ10**: 設計の整合性検証
  - 全ユーザーストーリーがコンポーネントモデルで実現可能であることを確認
  - 外部依存関係が適切に定義されていることを確認
  - DDD原則（高凝集・疎結合）が守られていることを確認

## 確認が必要な事項

### 1. カード仕様の詳細
- **質問**: カードの基本属性（コスト、タワータイプ、特殊能力）の具体的な仕様は？
- **質問**: 特殊能力の種類と効果の範囲は？
- **質問**: カードの希少度やバランス調整の仕組みは必要？

### 2. データ管理方針
- **質問**: 30種類以上のカードデータはどのように管理する？（JSON、データベース、ハードコード）
- **質問**: カードライブラリの永続化は必要？（ローカルストレージ、サーバー）
- **質問**: カード遭遇履歴の管理方法は？

### 3. システム連携方式
- **質問**: タワー配置システムとの連携はイベント駆動型か直接呼び出し型か？
- **質問**: ドラッグ&ドロップ操作の責任分担（UI vs ドメインロジック）は？
- **質問**: エラーハンドリングとユーザーフィードバックの方針は？

### 4. パフォーマンス要件
- **質問**: カード配布の応答時間要件は？
- **質問**: 同時プレイヤー数の想定は？（将来のマルチプレイヤー対応）
- **質問**: メモリ使用量の制約は？

## 成果物
- コンポーネントモデル文書（.kiro/specs/design-artifacts/card-strategy-management/component_model.md）
- 必要に応じてUML図やフロー図
- 外部インターフェース仕様

## 次のステップ
この計画の承認後、ステップ1から順次実行し、各ステップ完了時にチェックボックスを更新します。